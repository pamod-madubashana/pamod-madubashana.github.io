import{a as n,j as e}from"./ui-DPnNW4ni.js";import{c as V,f as o,t as ee,O as se,M as ae,B as u,L as w,i as $,j as Y,w as z,k as P,I as q,T as te,Q as L}from"./index-BKRUu3Yd.js";import{C as re,a as le,c as ne,b as ie}from"./card-J9P_t1mA.js";import{B as J}from"./badge-Dm88Lzor.js";import{L as v}from"./label-Cj93_cyk.js";import{S as de}from"./switch-9wmOAJRh.js";import"./index-BfNW_BBT.js";const ce=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],oe=V("refresh-cw",ce);const me=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],ue=V("reply",me),G=n.forwardRef(({className:a,...r},l)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:l,className:o("w-full caption-bottom text-sm",a),...r})}));G.displayName="Table";const K=n.forwardRef(({className:a,...r},l)=>e.jsx("thead",{ref:l,className:o("[&_tr]:border-b",a),...r}));K.displayName="TableHeader";const W=n.forwardRef(({className:a,...r},l)=>e.jsx("tbody",{ref:l,className:o("[&_tr:last-child]:border-0",a),...r}));W.displayName="TableBody";const he=n.forwardRef(({className:a,...r},l)=>e.jsx("tfoot",{ref:l,className:o("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r}));he.displayName="TableFooter";const F=n.forwardRef(({className:a,...r},l)=>e.jsx("tr",{ref:l,className:o("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",a),...r}));F.displayName="TableRow";const p=n.forwardRef(({className:a,...r},l)=>e.jsx("th",{ref:l,className:o("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r}));p.displayName="TableHead";const j=n.forwardRef(({className:a,...r},l)=>e.jsx("td",{ref:l,className:o("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r}));j.displayName="TableCell";const xe=n.forwardRef(({className:a,...r},l)=>e.jsx("caption",{ref:l,className:o("mt-4 text-sm text-muted-foreground",a),...r}));xe.displayName="TableCaption";const pe="Re: Your message to Pamod",R=a=>{const r=new Date(a);return Number.isNaN(r.getTime())?"Unknown":r.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},Q=a=>a==="new"?"bg-primary/20 text-primary border-primary/30":a==="replied"?"bg-emerald-500/20 text-emerald-500 border-emerald-500/30":"bg-muted text-muted-foreground border-border",C={subject:pe,body:"",includeOriginal:!0},ve=()=>{const{token:a}=ee(),{toast:r}=se(),[l,T]=n.useState([]),[S,k]=n.useState(!0),[A,y]=n.useState(null),[t,g]=n.useState(null),[N,B]=n.useState(null),[f,M]=n.useState(null),[h,x]=n.useState(C),[O,m]=n.useState(null),[c,_]=n.useState(!1),I=n.useMemo(()=>l.filter(s=>s.status==="new").length,[l]),H=async(s=!1)=>{if(!a){k(!1),y("Authentication is required to view contact messages.");return}try{k(!0),y(null);const i=await L.getMessages(a,s);T(i)}catch(i){y(i instanceof Error?i.message:"Failed to load messages.")}finally{k(!1)}};n.useEffect(()=>{H()},[a]);const X=s=>{M(s),x(C),m(null)},D=()=>{c||(M(null),x(C),m(null))},Z=async()=>{if(!a||!f)return;const s=h.subject.trim(),i=h.body.trim();if(s.length<3||s.length>140){m("Subject must be between 3 and 140 characters.");return}if(i.length<5||i.length>5e3){m("Message must be between 5 and 5000 characters.");return}try{_(!0),m(null);const d=await L.sendReply(a,f.id,{subject:s,body:i,includeOriginal:h.includeOriginal});T(E=>E.map(b=>b.id===d.id?d:b)),(t==null?void 0:t.id)===d.id&&g(d),r({title:"Reply sent",description:"Your reply was sent successfully."}),M(null),x(C),m(null)}catch(d){m(d instanceof Error?d.message:"Failed to send reply."),r({title:"Reply failed",description:"Could not send this reply right now.",variant:"destructive"})}finally{_(!1)}},U=async(s,i)=>{if(a)try{B(s.id);const d=await L.updateMessageStatus(a,s.id,i);T(E=>E.map(b=>b.id===d.id?d:b)),(t==null?void 0:t.id)===d.id&&g(d)}catch(d){y(d instanceof Error?d.message:"Failed to update message status.")}finally{B(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(re,{className:"glass border border-border",children:[e.jsxs(le,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ne,{className:"flex items-center gap-2 text-foreground/80",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),"Contact Messages"]}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:[I," new ",I===1?"message":"messages"]})]}),e.jsxs(u,{variant:"outline",onClick:()=>H(!0),disabled:S,children:[e.jsx(oe,{className:`w-4 h-4 mr-2 ${S?"animate-spin":""}`}),"Refresh"]})]}),e.jsx(ie,{children:S?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(w,{className:"w-6 h-6 animate-spin text-primary"})}):A?e.jsx("p",{className:"text-sm text-destructive",children:A}):l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No contact messages yet."}):e.jsxs(G,{children:[e.jsx(K,{children:e.jsxs(F,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Email"}),e.jsx(p,{children:"Received"}),e.jsx(p,{children:"Status"}),e.jsx(p,{className:"text-right",children:"Actions"})]})}),e.jsx(W,{children:l.map(s=>e.jsxs(F,{children:[e.jsx(j,{className:"font-medium",children:s.name}),e.jsx(j,{className:"text-muted-foreground",children:s.email}),e.jsx(j,{children:R(s.createdAt)}),e.jsx(j,{children:e.jsx(J,{variant:"outline",className:Q(s.status),children:s.status})}),e.jsxs(j,{className:"text-right space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>g(s),children:"View"}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>X(s),children:[e.jsx(ue,{className:"w-3 h-3 mr-2"}),"Reply"]}),e.jsxs(u,{variant:"outline",size:"sm",disabled:N===s.id,onClick:()=>U(s,s.status==="new"?"read":"new"),children:[N===s.id&&e.jsx(w,{className:"w-3 h-3 mr-2 animate-spin"}),"Mark as ",s.status==="new"?"read":"new"]})]})]},s.id))})]})})]}),e.jsx($,{open:!!t,onOpenChange:s=>!s&&g(null),children:e.jsxs(Y,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsx(P,{children:(t==null?void 0:t.name)||"Contact message"})}),t&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",t.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Received:"})," ",R(t.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",e.jsx(J,{variant:"outline",className:Q(t.status),children:t.status})]}),t.lastRepliedAt&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Last replied:"})," ",R(t.lastRepliedAt)]})]}),e.jsx("div",{className:"rounded-md border border-border bg-muted/30 p-4 whitespace-pre-wrap",children:t.message}),t.replies.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"font-medium",children:"Reply history"}),t.replies.map((s,i)=>e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:R(s.sentAt)}),e.jsx("p",{className:"text-sm font-medium mt-1",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 whitespace-pre-wrap",children:s.body.length>180?`${s.body.slice(0,177)}...`:s.body})]},`${s.sentAt}-${i}`))]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(u,{variant:"outline",disabled:N===t.id,onClick:()=>U(t,t.status==="new"?"read":"new"),children:[N===t.id&&e.jsx(w,{className:"w-3 h-3 mr-2 animate-spin"}),"Mark as ",t.status==="new"?"read":"new"]})})]})]})}),e.jsx($,{open:!!f,onOpenChange:s=>!s&&D(),children:e.jsxs(Y,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsx(P,{children:"Reply to message"})}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"reply-to",children:"Recipient"}),e.jsx(q,{id:"reply-to",value:f.email,readOnly:!0,disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"reply-subject",children:"Subject"}),e.jsx(q,{id:"reply-subject",value:h.subject,onChange:s=>x(i=>({...i,subject:s.target.value})),disabled:c,maxLength:140})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"reply-body",children:"Message"}),e.jsx(te,{id:"reply-body",rows:8,value:h.body,onChange:s=>x(i=>({...i,body:s.target.value})),disabled:c,maxLength:5e3})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border p-3",children:[e.jsx(v,{htmlFor:"include-original",className:"cursor-pointer",children:"Include original message"}),e.jsx(de,{id:"include-original",checked:h.includeOriginal,onCheckedChange:s=>x(i=>({...i,includeOriginal:s})),disabled:c})]}),O&&e.jsx("p",{className:"text-sm text-destructive",children:O}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:D,disabled:c,children:"Cancel"}),e.jsxs(u,{onClick:Z,disabled:c,children:[c&&e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),"Send Reply"]})]})]})]})})]})};export{ve as default};
