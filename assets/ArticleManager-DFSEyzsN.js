import{a as l,j as e}from"./ui-DPnNW4ni.js";import{C as E,b as T,a as V,c as X,d as Z}from"./card-CSQhpvfX.js";import{t as $,k as L,v as ee,B as d,n as B,w as O,o as P,I as g,T as f}from"./index-FvscKpJa.js";import{B as z}from"./badge-ICiN6x2s.js";import{L as n}from"./label-D5jxcCqS.js";import{a as j}from"./articleApi-i_CrYdrc.js";import{P as te,S as ae,T as se,C as re}from"./ConfirmDialog-BhTsqimn.js";import{S as U}from"./save-DHkxwqSN.js";import{S as le}from"./search-CTt-WShP.js";const xe=()=>{const[m,x]=l.useState([]),[w,A]=l.useState([]),[p,_]=l.useState(""),[G,J]=l.useState(!0),[W,v]=l.useState(!1),[a,c]=l.useState(null),[r,u]=l.useState({title:"",content:"",excerpt:"",featuredImage:"",status:"draft",tags:""}),[h,b]=l.useState(null),[I,F]=l.useState(!1),[S,D]=l.useState(!1),[q,N]=l.useState(!1),[y,C]=l.useState(null),{token:o}=$(),k=t=>{var i;const s=(i=t.target.files)==null?void 0:i[0];s&&b(s)},M=async()=>{if(!o){console.error("Authentication token is missing"),alert("You must be logged in to create an article");return}F(!0);try{const t=new FormData;t.append("title",r.title),t.append("content",r.content),t.append("excerpt",r.excerpt),t.append("status",r.status),t.append("tags",JSON.stringify(r.tags.split(",").map(i=>i.trim()).filter(i=>i))),h&&t.append("featuredImage",h),console.log("Sending request to create article with data:",{title:r.title,hasFeaturedImage:!!h});const s=await j.createArticleWithImage(o,t);console.log("Article created successfully:",s),x([s.article,...m]),u({title:"",content:"",excerpt:"",featuredImage:"",status:"draft",tags:""}),b(null),v(!1)}catch(t){console.error("Error creating article with image:",t),alert("Failed to create article: "+t.message)}finally{F(!1)}},R=async()=>{if(!a||!o){o||(console.error("Authentication token is missing"),alert("You must be logged in to update an article"));return}D(!0);try{const t=new FormData;t.append("title",a.title),t.append("content",a.content),t.append("excerpt",a.excerpt),t.append("status",a.status),t.append("tags",JSON.stringify(a.tags)),h&&t.append("featuredImage",h),console.log("Sending request to update article with data:",{id:a._id,title:a.title,hasFeaturedImage:!!h});const s=await j.updateArticleWithImage(o,a._id,t);console.log("Article updated successfully:",s),x(m.map(i=>i._id===a._id?s.article:i)),c(null),b(null)}catch(t){console.error("Error updating article with image:",t),alert("Failed to update article: "+t.message)}finally{D(!1)}};l.useEffect(()=>{(async()=>{try{const s=await j.getAllArticles(o);x(s.articles||[])}catch(s){console.error("Error fetching articles:",s)}finally{J(!1)}})()},[o]),l.useEffect(()=>{if(!p)A(m);else{const t=p.toLowerCase();A(m.filter(s=>s.title.toLowerCase().includes(t)||s.content.toLowerCase().includes(t)||s.tags.some(i=>i.toLowerCase().includes(t))))}},[p,m]);const H=async t=>{C(t),N(!0)},Y=async()=>{if(!(!y||!o))try{await j.deleteArticle(o,y),x(m.filter(t=>t._id!==y))}catch(t){console.error("Error deleting article:",t)}finally{N(!1),C(null)}},K=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsx("div",{className:"min-h-screen from-gray-900 to-gray-800 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Article Manager"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your blog posts and articles"})]}),e.jsxs(L,{open:W,onOpenChange:v,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"New Article"]})}),e.jsxs(B,{className:"max-w-3xl max-h-[90vh] overflow-y-auto bg-gray-900 text-white border border-gray-700",children:[e.jsx(O,{children:e.jsx(P,{children:"Create New Article"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"title",children:"Title"}),e.jsx(g,{id:"title",value:r.title,onChange:t=>u({...r,title:t.target.value}),placeholder:"Enter article title",className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"excerpt",children:"Excerpt"}),e.jsx(f,{id:"excerpt",value:r.excerpt,onChange:t=>u({...r,excerpt:t.target.value}),placeholder:"Brief description of the article",rows:3,className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0 resize-none"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"featuredImage",children:"Featured Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{id:"featuredImage",type:"url",value:r.featuredImage,onChange:t=>u({...r,featuredImage:t.target.value}),placeholder:"https://example.com/image.jpg",className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0"}),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>{var t;return(t=document.getElementById("file-upload-create"))==null?void 0:t.click()},className:"border-input text-foreground hover:bg-accent hover:text-accent-foreground",children:"Choose File"}),e.jsx(g,{id:"file-upload-create",type:"file",accept:"image/*",onChange:k,className:"hidden"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter image URL or upload a file (JPG, PNG, GIF)"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"content",children:"Content"}),e.jsx(f,{id:"content",value:r.content,onChange:t=>u({...r,content:t.target.value}),placeholder:"Write your article content here...",rows:8,className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0 resize-none"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"tags",children:"Tags (comma separated)"}),e.jsx(g,{id:"tags",value:r.tags,onChange:t=>u({...r,tags:t.target.value}),placeholder:"tag1, tag2, tag3",className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{children:"Status"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"status",checked:r.status==="draft",onChange:()=>u({...r,status:"draft"})}),"Draft"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"status",checked:r.status==="published",onChange:()=>u({...r,status:"published"})}),"Published"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>v(!1),className:"border-input text-foreground hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e.jsx(d,{onClick:M,disabled:I,children:I?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Create Article"]})})]})]})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(g,{placeholder:"Search articles...",value:p,onChange:t=>_(t.target.value),className:"flex h-10 w-full rounded-md border border-input bg-white dark:bg-slate-800 text-gray-900 dark:text-white px-3 py-2 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm pl-10"})]})}),G?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading articles..."})}):w.length===0?e.jsx(E,{className:"glass border border-primary/30",children:e.jsx(T,{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No articles found"})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(t=>{var s;return e.jsxs(E,{className:"glass border border-primary/30",children:[e.jsxs(V,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(X,{className:"text-xl",children:t.title}),e.jsx(z,{variant:t.status==="published"?"default":"secondary",children:t.status})]}),e.jsxs(Z,{children:["By ",((s=t.author)==null?void 0:s.username)||"Unknown Author"," â€¢ ",K(t.createdAt)]})]}),e.jsxs(T,{children:[e.jsx("p",{className:"text-muted-foreground mb-4 line-clamp-3",children:t.excerpt||t.content.substring(0,100)+"..."}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.tags.map((i,Q)=>e.jsx(z,{variant:"outline",children:i},Q))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>{c(t)},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>H(t._id),className:"text-red-500 border-red-500 hover:bg-red-500/10",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]},t._id)})}),a&&e.jsx(L,{open:!!a,onOpenChange:t=>!t&&c(null),children:e.jsxs(B,{className:"max-w-3xl max-h-[90vh] overflow-y-auto bg-gray-900 text-white border border-gray-700",children:[e.jsx(O,{children:e.jsx(P,{children:"Edit Article"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"edit-title",children:"Title"}),e.jsx(g,{id:"edit-title",value:a.title,onChange:t=>c({...a,title:t.target.value}),placeholder:"Enter article title",className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"edit-excerpt",children:"Excerpt"}),e.jsx(f,{id:"edit-excerpt",value:a.excerpt,onChange:t=>c({...a,excerpt:t.target.value}),placeholder:"Brief description of the article",rows:3,className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0 resize-none"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"edit-featuredImage",children:"Featured Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{id:"edit-featuredImage",type:"url",value:a.featuredImage||"",onChange:t=>c({...a,featuredImage:t.target.value}),placeholder:"https://example.com/image.jpg",className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0"}),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>{var t;return(t=document.getElementById("file-upload-edit"))==null?void 0:t.click()},className:"border-input text-foreground hover:bg-accent hover:text-accent-foreground",children:"Choose File"}),e.jsx(g,{id:"file-upload-edit",type:"file",accept:"image/*",onChange:k,className:"hidden"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter image URL or upload a file (JPG, PNG, GIF)"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"edit-content",children:"Content"}),e.jsx(f,{id:"edit-content",value:a.content,onChange:t=>c({...a,content:t.target.value}),placeholder:"Write your article content here...",rows:8,className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0 resize-none"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"edit-tags",children:"Tags (comma separated)"}),e.jsx(g,{id:"edit-tags",value:a.tags.join(", "),onChange:t=>c({...a,tags:t.target.value.split(",").map(s=>s.trim())}),placeholder:"tag1, tag2, tag3",className:"bg-gray-800 border-none text-white placeholder-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{children:"Status"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"edit-status",checked:a.status==="draft",onChange:()=>c({...a,status:"draft"})}),"Draft"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"edit-status",checked:a.status==="published",onChange:()=>c({...a,status:"published"})}),"Published"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>c(null),className:"border-input text-foreground hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e.jsx(d,{onClick:R,disabled:S,children:S?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})]})}),e.jsx(re,{isOpen:q,onClose:()=>{N(!1),C(null)},onConfirm:Y,title:"Delete Article",message:"Are you sure you want to delete this article? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"destructive"})]})})};export{xe as default};
